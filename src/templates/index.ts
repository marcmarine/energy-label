import { html, svg, type SVGTemplateResult } from 'lit-html'
import { render } from '@lit-labs/ssr'
import { collectResultSync } from '@lit-labs/ssr/lib/render-result.js'
import reg2019R2016 from './02019R2016-20230930'
import type { EnergyLabelOptions } from '../EnergyLabel'
import { mmToPx } from '../utils'
import type { EURegulationAct } from '../definitions'

const header = (supplierOrTrademark: string = "Supplier's name", modelIdentifier: string = 'Model Identifier', qrCodeImage?: SVGTemplateResult) => svg`
<g id="eu-branding">
  ${qrCodeImage}
  <g id="eu-flag">
    <rect x="${mmToPx(3)}" y="${mmToPx(3)}" width="${mmToPx(21)}" height="${mmToPx(14)}" fill="#034EA2" />
    <g id="stars" fill="#FFF200">
      <path d="M50.135 19.6685L50.9572 17.0014L51.7661 19.6685H54.5244L52.3098 21.4021L53.1585 24.1358L50.9572 22.4555L48.7559 24.1358L49.6311 21.4021L47.39 19.6685H50.135Z"  />
      <path d="M50.3066 54.9011L51.1942 52.2274L52.0537 54.9011H54.9703L52.6173 56.6327L53.5331 59.3618L51.1942 57.6856L48.8412 59.3618L49.7712 56.6327L47.39 54.9011H50.3066Z"  />
      <path d="M59.053 52.6716L59.8884 49.9979L60.6974 52.6716H63.4424L61.2278 54.3894L62.0898 57.1323L59.8884 55.4422L57.6739 57.1323L58.5491 54.3894L56.308 52.6716H59.053Z" />
      <path d="M59.053 21.9046L59.8884 19.2309L60.6974 21.9046H63.4424L61.2278 23.6224L62.0898 26.3653L59.8884 24.6752L57.6739 26.3653L58.5491 23.6224L56.308 21.9046H59.053Z" />
      <path d="M65.7414 28.4259L66.5636 25.9194L67.3725 28.4259H70.1308L67.9162 30.0364L68.7649 32.6079L66.5636 31.0364L64.3623 32.6079L65.2375 30.0364L62.9964 28.4259H65.7414Z"/>
      <path d="M65.7414 46.257L66.5636 43.7553L67.3725 46.257H70.1308L67.9162 47.8773L68.7649 50.4438L66.5636 48.8624L64.3623 50.4438L65.2375 47.8773L62.9964 46.257H65.7414Z" />
      <path d="M67.9577 37.3309L68.7932 34.8374L69.6021 37.3309H72.3604L70.1458 38.9543L70.9945 41.5258L68.7932 39.9414L66.5918 41.5258L67.4538 38.9543L65.226 37.3309H67.9577Z"  />
      <path d="M41.217 21.8907L42.0525 19.2309L42.8614 21.8907H45.6064L43.3918 23.6224L44.2538 26.3653L42.0525 24.6752L39.8379 26.3653L40.7131 23.6224L38.472 21.8907H41.217Z" />
      <path d="M34.9745 28.5879L35.8099 25.9194L36.6188 28.5879H39.3638L37.1493 30.3162L38.0112 33.0538L35.8099 31.367L33.5953 33.0538L34.4705 30.3162L32.2294 28.5879H34.9745Z" />
      <path d="M32.745 37.3391L33.5804 34.8374L34.3893 37.3391H37.1343L34.9197 38.9593L35.7817 41.5258L33.5804 39.9445L31.3658 41.5258L32.241 38.9593L29.9999 37.3391H32.745Z" />
      <path d="M34.9745 46.257L35.8099 43.7553L36.6188 46.257H39.3638L37.1493 47.8773L38.0112 50.4438L35.8099 48.8624L33.5953 50.4438L34.4705 47.8773L32.2294 46.257H34.9745Z"  />
      <path d="M41.3886 52.6664L42.2622 49.9979L43.1357 52.6664H46.0523L43.6993 54.3947L44.6011 57.1323L42.2622 55.4455L39.9233 57.1323L40.8532 54.3947L38.472 52.6664H41.3886Z"  />
    </g>
  </g>
  <g id="logo">
    <path d="M98.2699 56.355V18.4991H124.101V26.0569H106.145V33.2815H123.357V40.6661H106.145V48.9571H124.101V56.355H98.2699Z" fill="#034EA2" />
    <path d="M152.879 43.9985V18.4991H160.621V56.355H151.376L135.851 31.1888V56.355H128.109V18.4991H137.341L152.879 43.9985Z" fill="#034EA2" />
    <path d="M165.074 56.355V18.4991H190.46V26.0569H172.818V33.2815H189.742V40.6661H172.818V48.9571H190.46V56.355H165.074Z" fill="#034EA2" />
    <path
      d="M194.468 56.355V18.5024H212.404C214.208 18.4698 216.009 18.676 217.758 19.1157C219.136 19.4684 220.406 20.1555 221.452 21.1157C222.477 22.1315 223.22 23.3949 223.607 24.7823C224.109 26.5921 224.343 28.4651 224.303 30.3422C224.304 31.4926 224.228 32.6417 224.076 33.7821C223.946 34.7741 223.74 35.7547 223.46 36.7154C223.109 37.7088 222.488 38.5857 221.667 39.2487C222.42 40.0571 222.982 41.0228 223.313 42.0753C223.68 43.2444 223.861 44.4636 223.848 45.6885V56.355H215.817V46.5418C215.883 46.0092 215.827 45.4686 215.653 44.9607C215.479 44.4527 215.192 43.9905 214.814 43.6086C213.862 43.0065 212.738 42.7303 211.615 42.8219H202.245V56.355H194.468ZM202.312 35.4754H211.106C212.026 35.492 212.945 35.416 213.85 35.2487C214.402 35.1536 214.933 34.9594 215.416 34.6754C215.978 34.2221 216.259 33.0754 216.259 31.2355C216.355 29.8424 216.183 28.4439 215.75 27.1156C215.416 26.3689 214.318 25.9823 212.444 25.9823H202.312V35.4621V35.4754Z"
      fill="#034EA2"
    />
    <path
      d="M241.728 35.6733H260.06C260.249 37.0986 260.343 38.1643 260.37 38.857C260.397 39.5497 260.37 40.1891 260.37 40.6953V43.7991C260.416 46.4436 259.996 49.0759 259.13 51.5785C258.648 52.9508 257.725 54.1297 256.502 54.9354C254.983 55.8465 253.271 56.3981 251.501 56.5472C250.377 56.6627 249.214 56.7382 248.01 56.7737C246.805 56.8092 245.601 56.8092 244.397 56.7737C238.376 56.7737 234.238 55.8146 231.982 53.8964C229.538 51.9071 228.316 47.9774 228.316 42.1073V39.7895C228.316 39.0035 228.316 38.191 228.316 37.3651V32.9025C228.316 28.0182 229.314 24.4082 231.309 22.0726C232.476 20.8152 233.967 19.8945 235.622 19.4084C237.712 18.7682 239.891 18.4624 242.079 18.5026H244.154C244.828 18.5026 245.525 18.5026 246.244 18.5026H250.193C253.878 18.618 256.461 19.6038 257.944 21.4598C259.626 23.7676 260.462 26.5722 260.316 29.4124V32.716H252.417C252.57 30.7238 252.36 28.7206 251.797 26.8015C251.609 26.4285 250.827 26.2021 249.425 26.1222C248.257 26.0511 247.12 26.0067 246.015 25.989H242.55C239.657 25.989 237.945 26.2909 237.415 26.8948C236.885 27.4987 236.583 29.5856 236.512 33.1556C236.512 33.5286 236.512 33.8838 236.512 34.2213C236.512 34.5543 236.512 34.9406 236.512 35.3536V37.4983V42.2938C236.512 43.2662 236.512 44.1987 236.619 45.0512C236.68 45.8513 236.811 46.6446 237.01 47.4224V47.3158C237.214 47.7526 237.524 48.1325 237.913 48.4214C238.449 48.7884 239.071 49.0132 239.72 49.0742C240.488 49.184 241.262 49.2419 242.038 49.2474C242.483 49.2474 242.955 49.2474 243.386 49.2474H246.743C247.809 49.258 248.876 49.2091 249.937 49.1008C250.539 49.0874 251.121 48.8818 251.595 48.5147C252.121 48.0618 252.39 46.5565 252.39 44.0122V43.1064H241.728V35.6733Z"
      fill="#034EA2"
    />
    <path d="M279.408 18.4991L276 29.4149L285.323 27.8651L271.982 57.2457L276 35.9484L267.063 36.3359L270.842 18.4991H279.408Z" fill="#034EA2" />
  </g>
</g>
<g id="product">
  <text id="supplier-name" fill="black" font-family="Verdana" font-size="12" font-weight="bold">
    <tspan x="${mmToPx(3)}" y="${mmToPx(25)}">${supplierOrTrademark}</tspan>
  </text>
  <text id="model-identifier" fill="black" font-family="Verdana" font-size="12" text-anchor="end">
    <tspan x="${mmToPx(93)}" y="${mmToPx(25)}">${modelIdentifier}</tspan>
  </text>
  <path d="M${mmToPx(3)} ${mmToPx(27)}H${mmToPx(93)}" stroke="black" stroke-width="0.5pt" />
</g>
`

export function renderTemplate(
  _regulation: EURegulationAct,
  options: Partial<
    EnergyLabelOptions & {
      qrCodeImage: SVGTemplateResult
    }
  >
) {
  const template = html`
    <svg width="${mmToPx(96)}" height="${mmToPx(192)}" viewBox="0 0 ${mmToPx(96)} ${mmToPx(192)}" fill="none" xmlns="http://www.w3.org/2000/svg">
      <rect width="${mmToPx(96)}" height="${mmToPx(192)}" fill="white" />
      ${header(options.supplierOrTrademark, options.modelIdentifier, options.qrCodeImage)}
      ${reg2019R2016(options.efficiencyClass, options.consolidatedEnergyConsAnnual, options.capBottles, options.noise, options.noiseClass)}
    </svg>
  `

  const result = render(template)
  const contentString = collectResultSync(result)

  return contentString
}
